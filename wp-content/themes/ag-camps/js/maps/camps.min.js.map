{"version":3,"sources":["camps.js"],"names":["debounceFetchTimeout","document","addEventListener","initmap","addPriceBracketTooltip","fulldates","Array","from","querySelector","options","map","x","value","date_qty","get2DigitFmt","val","slice","forEach","innerHTML","pickr","flatpickr","inline","mode","dateFormat","locale","enable","onChange","selectedDates","dateStr","instance","debouceFetch","onDayCreate","dObj","dStr","fp","dayElem","date","dateObj","format_date","getFullYear","getMonth","getDate","indexOf","className","Object","keys","insertAdjacentHTML","concat","onReady","this","config","_enable","length","jumpToDate","e","target","parentNode","classList","toggle","body","querySelectorAll","setDate","preventDefault","id","addToCart","isFetchingPrice","queueFetch","clearTimeout","setTimeout","fetchAddToCart","loader","remove","form","formdata","FormData","object","key","Reflect","has","isArray","push","wp","apiFetch","path","method","data","then","response","renderAddToCart","add","container","noRes","success","price","cumulative","old_bracket_el","bracket_el","price_bracket","error","location","href","redirect","getElementById","lat","parseFloat","getAttribute","lng","google","maps","Map","zoom","center","scrollwheel","zoomControl","disableDefaultUI","Marker","position","info","el","tippy","interactive","theme","allowHTML","content","placement","zIndex","appendTo"],"mappings":"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","file":"../camps.min.js","sourcesContent":["document.addEventListener('DOMContentLoaded', function() {\r\n\r\n    initmap();\r\n    addPriceBracketTooltip();\r\n\r\n    const fulldates = Array.from(document.querySelector('#full-days').options).map((x)=>x.value)\r\n    let date_qty = {};\r\n    Array.from(document.querySelector('#valid-days').options).forEach((x)=>{date_qty[x.value] = x.innerHTML;})\r\n\r\n    function get2DigitFmt(val) {\r\n        return ('0' + val).slice(-2);\r\n    }\r\n\r\n    const pickr = flatpickr(\"#calendrier\", {\r\n        inline: true,\r\n        mode: \"multiple\",\r\n        dateFormat: \"Y-m-d\",\r\n        locale:\"fr\",\r\n        enable:  Array.from(document.querySelector('#valid-days').options).map((x)=>x.value),\r\n        onChange: function(selectedDates, dateStr, instance) {\r\n            debouceFetch()\r\n        },\r\n        onDayCreate: function(dObj, dStr, fp, dayElem) {\r\n            const date = dayElem.dateObj;\r\n            const format_date = date.getFullYear()+'-'+get2DigitFmt(date.getMonth() + 1)+'-'+get2DigitFmt(date.getDate());\r\n            if (fulldates.indexOf(format_date) !== -1) {\r\n              dayElem.className += \" date-full\";\r\n            }\r\n            if(Object.keys(date_qty).indexOf(format_date) !== -1){\r\n                dayElem.insertAdjacentHTML('beforeEnd',`<span title=\"${date_qty[format_date]} place${date_qty[format_date]>1?'s':''} disponible${date_qty[format_date]>1?'s':''}.\">${date_qty[format_date]}</span>`);\r\n            }\r\n\r\n\r\n\r\n        },\r\n        onReady: function(){\r\n            if(this.config._enable.length>0){\r\n                this.jumpToDate(this.config._enable[0]);\r\n            }else if(fulldates.length>0){\r\n                this.jumpToDate(fulldates[0]);\r\n            }\r\n        }\r\n    });\r\n\r\n    document.querySelector('.camp-reservation h2').addEventListener('click',function(e){\r\n        e.target.parentNode.classList.toggle('open')\r\n        document.body.classList.toggle('add-to-cart-open')\r\n    })\r\n\r\n    document.querySelectorAll('[name=\"enfants[]\"]').forEach(x=>x.addEventListener('click',function(){\r\n        debouceFetch()\r\n    }))\r\n\r\n    document.querySelector('#all-week').addEventListener('click',function(){\r\n        pickr.setDate(Array.from(document.querySelector('#valid-days').options).map((x)=>x.value),true)\r\n    })\r\n\r\n    document.querySelector('#all-week').addEventListener('click',function(){\r\n        pickr.setDate(Array.from(document.querySelector('#valid-days').options).map((x)=>x.value),true)\r\n    })\r\n\r\n    document.querySelector('#inscription').addEventListener('submit',function(e){\r\n        e.preventDefault();\r\n    })\r\n\r\n    document.body.addEventListener('click',e=>{\r\n        if(e.target.id == \"bouton-add-to-cart\"){\r\n            addToCart();\r\n        }\r\n    })\r\n\r\n\r\n    debouceFetch();\r\n});\r\n\r\nlet debounceFetchTimeout;\r\nlet isFetchingPrice = false;\r\nlet queueFetch = false;\r\nfunction debouceFetch(){\r\n    if(!isFetchingPrice){\r\n        clearTimeout(debounceFetchTimeout);\r\n        debounceFetchTimeout = setTimeout(fetchAddToCart,250);\r\n    }else{\r\n        queueFetch = true;\r\n    }\r\n    \r\n}\r\nfunction fetchAddToCart(){\r\n    document.querySelector('p.error').innerHTML = \"\";\r\n    const loader = document.querySelector('#add-to-cart .loader');\r\n    loader.classList.remove('hide')\r\n    isFetchingPrice = true;\r\n    queueFetch = false;\r\n    const form = document.querySelector('#inscription');\r\n    const formdata = new FormData(form)\r\n    let object = {};\r\n    formdata.forEach((value, key) => {\r\n        if(!Reflect.has(object, key)){\r\n            object[key] = value;\r\n            return;\r\n        }\r\n        if(!Array.isArray(object[key])){\r\n            object[key] = [object[key]];    \r\n        }\r\n        object[key].push(value);\r\n    });\r\n\r\n    wp.apiFetch({\r\n        path:'inscriptions/load-add-to-cart',\r\n        method:\"POST\",\r\n        data:object\r\n    }).then(response=>{\r\n        isFetchingPrice = false;\r\n        if(queueFetch){\r\n            fetchAddToCart();\r\n        }else{\r\n            renderAddToCart(response)\r\n            loader.classList.add('hide')\r\n        }\r\n    });\r\n}\r\n\r\nfunction renderAddToCart(data){\r\n    const container = document.querySelector('#add-to-cart .inner');\r\n    const noRes = document.querySelector('#add-to-cart .no-choice');\r\n    if(!data.success){\r\n        container.classList.add('hide');\r\n        noRes.classList.remove('hide');\r\n        return;\r\n    }else{\r\n        noRes.classList.add('hide');\r\n        container.classList.remove('hide');\r\n    }\r\n    container.innerHTML = \"\";\r\n    container.insertAdjacentHTML('afterbegin',`\r\n        <h4><span>Prix:</span> <span>${data.price}</span></h4>\r\n        <button id=\"bouton-add-to-cart\" class=\"ins-btn\">Ajouter au panier</button>\r\n        <p><small>Cumul des journées inscrites: ${data.cumulative}</small></p> \r\n    `);\r\n    const old_bracket_el = document.querySelector(`.selected_bracket`);\r\n    if(old_bracket_el){\r\n        old_bracket_el.classList.remove('selected_bracket');\r\n    }\r\n\r\n    const bracket_el = document.querySelector(`[data-bracket=\"${data.price_bracket}\"]`);\r\n    if(bracket_el){\r\n        bracket_el.classList.add('selected_bracket');\r\n    }\r\n\r\n}\r\n\r\nfunction addToCart(){\r\n    const error = document.querySelector('p.error');\r\n    const loader = document.querySelector('#add-to-cart .loader');\r\n    loader.classList.remove('hide')\r\n    isFetchingPrice = true;\r\n    queueFetch = false;\r\n    const form = document.querySelector('#inscription');\r\n    const formdata = new FormData(form)\r\n    let object = {};\r\n    formdata.forEach((value, key) => {\r\n        if(!Reflect.has(object, key)){\r\n            object[key] = value;\r\n            return;\r\n        }\r\n        if(!Array.isArray(object[key])){\r\n            object[key] = [object[key]];    \r\n        }\r\n        object[key].push(value);\r\n    });\r\n\r\n    wp.apiFetch({\r\n        path:'inscriptions/add-to-cart',\r\n        method:\"POST\",\r\n        data:object\r\n    }).then(response=>{\r\n        loader.classList.add('hide')\r\n        if(response.success){\r\n            location.href = response.redirect;\r\n        }else{\r\n            error.innerHTML = response.error;\r\n        }\r\n        \r\n    });\r\n}\r\n\r\nfunction initmap(){\r\n    const container = document.getElementById('map');\r\n    if(!container) return \r\n    const lat = parseFloat(container.getAttribute('data-lat'));\r\n    const lng = parseFloat(container.getAttribute('data-lng'));\r\n    const address = container.getAttribute('data-address');\r\n\r\n    const map = new google.maps.Map( container,{\r\n        zoom: 16,\r\n        center: {lat:lat,lng:lng},\r\n        scrollwheel : false,\r\n        zoomControl: true,\r\n        disableDefaultUI: true,\r\n    });\r\n\r\n    const marker = new google.maps.Marker({\r\n        position: {lat:lat,lng:lng},\r\n        map: map,\r\n        \r\n      });\r\n    \r\n    \r\n    \r\n}\r\n\r\n\r\nfunction addPriceBracketTooltip(info){\r\n    document.querySelectorAll('td i.fa-circle-info').forEach(el=>{\r\n        var tooltip = new tippy(el, {\r\n            interactive:true,\r\n            theme:'dark content-camp',\r\n            allowHTML:true,\r\n            content:`Le prix est calculé selon le nombre de journée inscrite cumulative de l'année en cours.`,\r\n            placement: 'top',\r\n            zIndex:99999,\r\n            appendTo: () => document.body\r\n        });\r\n    })\r\n    \r\n}"]}