{"version":3,"sources":["camps.js"],"names":["debounceFetchTimeout","document","addEventListener","tippy","interactive","theme","allowHTML","content","querySelector","placement","showOnCreate","fulldates","Array","from","options","map","x","value","date_qty","get2DigitFmt","val","slice","forEach","innerHTML","pickr","flatpickr","inline","mode","dateFormat","enable","onChange","selectedDates","dateStr","instance","debouceFetch","onDayCreate","dObj","dStr","fp","dayElem","date","dateObj","format_date","getFullYear","getMonth","getDate","indexOf","className","Object","keys","insertAdjacentHTML","concat","e","target","parentNode","classList","toggle","body","querySelectorAll","setDate","preventDefault","id","addToCart","isFetchingPrice","queueFetch","clearTimeout","setTimeout","fetchAddToCart","loader","remove","form","formdata","FormData","object","key","Reflect","has","isArray","push","wp","apiFetch","path","method","data","then","response","renderAddToCart","add","container","noRes","success","price","error","location","href","redirect"],"mappings":"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","file":"../camps.min.js","sourcesContent":["document.addEventListener('DOMContentLoaded', function() {\r\n\r\n    var tooltip = new tippy('#add-kid', {\r\n        interactive:true,\r\n        theme:'dark',\r\n        allowHTML:true,\r\n        content:document.querySelector('#enfantinputs'),\r\n        placement: 'top',\r\n        showOnCreate: true,\r\n    });\r\n    // document.querySelector('#enfantinputs').remove();\r\n\r\n    const fulldates = Array.from(document.querySelector('#full-days').options).map((x)=>x.value)\r\n    let date_qty = {};\r\n    Array.from(document.querySelector('#valid-days').options).forEach((x)=>{date_qty[x.value] = x.innerHTML;})\r\n\r\n    function get2DigitFmt(val) {\r\n        return ('0' + val).slice(-2);\r\n    }\r\n\r\n    const pickr = flatpickr(\"#calendrier\", {\r\n        inline: true,\r\n        mode: \"multiple\",\r\n        dateFormat: \"Y-m-d\",\r\n        enable:  Array.from(document.querySelector('#valid-days').options).map((x)=>x.value),\r\n        onChange: function(selectedDates, dateStr, instance) {\r\n            debouceFetch()\r\n        },\r\n        onDayCreate: function(dObj, dStr, fp, dayElem) {\r\n            const date = dayElem.dateObj;\r\n            const format_date = date.getFullYear()+'-'+get2DigitFmt(date.getMonth() + 1)+'-'+get2DigitFmt(date.getDate());\r\n            if (fulldates.indexOf(format_date) !== -1) {\r\n              dayElem.className += \" date-full\";\r\n            }\r\n            if(Object.keys(date_qty).indexOf(format_date) !== -1){\r\n                dayElem.insertAdjacentHTML('beforeEnd',`<span title=\"${date_qty[format_date]} place${date_qty[format_date]>1?'s':''} disponible${date_qty[format_date]>1?'s':''}.\">${date_qty[format_date]}</span>`);\r\n            }\r\n\r\n\r\n\r\n        }\r\n    });\r\n\r\n    document.querySelector('.camp-reservation h2').addEventListener('click',function(e){\r\n        e.target.parentNode.classList.toggle('open')\r\n        document.body.classList.toggle('add-to-cart-open')\r\n    })\r\n\r\n    document.querySelectorAll('[name=\"enfants[]\"]').forEach(x=>x.addEventListener('click',function(){\r\n        debouceFetch()\r\n    }))\r\n\r\n    document.querySelector('#all-week').addEventListener('click',function(){\r\n        pickr.setDate(Array.from(document.querySelector('#valid-days').options).map((x)=>x.value),true)\r\n    })\r\n\r\n    document.querySelector('#all-week').addEventListener('click',function(){\r\n        pickr.setDate(Array.from(document.querySelector('#valid-days').options).map((x)=>x.value),true)\r\n    })\r\n\r\n    document.querySelector('#inscription').addEventListener('submit',function(e){\r\n        e.preventDefault();\r\n    })\r\n\r\n    document.body.addEventListener('click',e=>{\r\n        if(e.target.id == \"bouton-add-to-cart\"){\r\n            addToCart();\r\n        }\r\n    })\r\n\r\n\r\n    debouceFetch();\r\n});\r\n\r\nlet debounceFetchTimeout;\r\nlet isFetchingPrice = false;\r\nlet queueFetch = false;\r\nfunction debouceFetch(){\r\n    if(!isFetchingPrice){\r\n        clearTimeout(debounceFetchTimeout);\r\n        debounceFetchTimeout = setTimeout(fetchAddToCart,250);\r\n    }else{\r\n        queueFetch = true;\r\n    }\r\n    \r\n}\r\nfunction fetchAddToCart(){\r\n    document.querySelector('p.error').innerHTML = \"\";\r\n    const loader = document.querySelector('#add-to-cart .loader');\r\n    loader.classList.remove('hide')\r\n    isFetchingPrice = true;\r\n    queueFetch = false;\r\n    const form = document.querySelector('#inscription');\r\n    const formdata = new FormData(form)\r\n    let object = {};\r\n    formdata.forEach((value, key) => {\r\n        if(!Reflect.has(object, key)){\r\n            object[key] = value;\r\n            return;\r\n        }\r\n        if(!Array.isArray(object[key])){\r\n            object[key] = [object[key]];    \r\n        }\r\n        object[key].push(value);\r\n    });\r\n\r\n    wp.apiFetch({\r\n        path:'inscriptions/load-add-to-cart',\r\n        method:\"POST\",\r\n        data:object\r\n    }).then(response=>{\r\n        isFetchingPrice = false;\r\n        if(queueFetch){\r\n            fetchAddToCart();\r\n        }else{\r\n            renderAddToCart(response)\r\n            loader.classList.add('hide')\r\n        }\r\n    });\r\n}\r\n\r\nfunction renderAddToCart(data){\r\n    const container = document.querySelector('#add-to-cart .inner');\r\n    const noRes = document.querySelector('#add-to-cart .no-choice');\r\n    if(!data.success){\r\n        container.classList.add('hide');\r\n        noRes.classList.remove('hide');\r\n        return;\r\n    }else{\r\n        noRes.classList.add('hide');\r\n        container.classList.remove('hide');\r\n    }\r\n    container.innerHTML = \"\";\r\n    container.insertAdjacentHTML('afterbegin',`\r\n        <h4><span>Prix:</span> <span>${data.price}$</span></h4>\r\n        <button id=\"bouton-add-to-cart\" class=\"ins-btn\">Ajouter au panier</button>\r\n    `)\r\n\r\n}\r\n\r\nfunction addToCart(){\r\n    const error = document.querySelector('p.error');\r\n    const loader = document.querySelector('#add-to-cart .loader');\r\n    loader.classList.remove('hide')\r\n    isFetchingPrice = true;\r\n    queueFetch = false;\r\n    const form = document.querySelector('#inscription');\r\n    const formdata = new FormData(form)\r\n    let object = {};\r\n    formdata.forEach((value, key) => {\r\n        if(!Reflect.has(object, key)){\r\n            object[key] = value;\r\n            return;\r\n        }\r\n        if(!Array.isArray(object[key])){\r\n            object[key] = [object[key]];    \r\n        }\r\n        object[key].push(value);\r\n    });\r\n\r\n    wp.apiFetch({\r\n        path:'inscriptions/add-to-cart',\r\n        method:\"POST\",\r\n        data:object\r\n    }).then(response=>{\r\n        loader.classList.add('hide')\r\n        if(response.success){\r\n            location.href = response.redirect;\r\n        }else{\r\n            error.innerHTML = response.error;\r\n        }\r\n        \r\n    });\r\n}"]}